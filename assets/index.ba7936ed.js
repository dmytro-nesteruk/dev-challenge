var E=Object.defineProperty;var x=(r,e,i)=>e in r?E(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i;var t=(r,e,i)=>(x(r,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(s){if(s.ep)return;s.ep=!0;const c=i(s);fetch(s.href,c)}})();var o=(r=>(r.airplane="airplane",r.helicopter="helicopter",r.rocket="rocket",r.drone="drone",r.explosion="explosion",r))(o||{});const D="/dev-challenge/assets/rocket-white.f0779ea1.svg",k="/dev-challenge/assets/drone-white.db8501a6.svg",w="/dev-challenge/assets/airplane-white.58eb1318.svg",I="/dev-challenge/assets/helicopter-white.53fa16e7.svg",L="/dev-challenge/assets/explosion-white.5bbc322b.svg";class A{constructor({defaultDanger:e=o.rocket,emitt:i}){t(this,"buttons");t(this,"emitt");t(this,"availableDangers");t(this,"element");t(this,"selectedDanger");t(this,"handleClick",e=>{const n=e.target.closest("button");if(!n)return;const c=n.id.split("-").at(-1),a=this.availableDangers.find(l=>l===c);a&&a!==this.selectedDanger&&(this.selectedDanger=a,this.emitt("DANGER_TYPE_CHANGED",this.selectedDanger),this.update(this.selectedDanger))});t(this,"init",()=>{this.element.classList.add("danger-picker"),this.buttons=[this.createBtn(D,o.rocket,this.selectedDanger===o.rocket),this.createBtn(k,o.drone,this.selectedDanger===o.drone),this.createBtn(w,o.airplane,this.selectedDanger===o.airplane),this.createBtn(I,o.helicopter,this.selectedDanger===o.helicopter),this.createBtn(L,o.explosion,this.selectedDanger===o.explosion)],this.element.addEventListener("click",this.handleClick),this.buttons.forEach(e=>{this.element.append(e)})});t(this,"update",e=>{const i=this.buttons.find(s=>s.id.includes(e));if(!i)return;const n=this.buttons.find(s=>s.classList.contains("active"));n&&n.classList.remove("active"),i.classList.add("active")});t(this,"createBtn",(e,i,n=!1)=>{const s=document.createElement("button"),c=this.createIcon(e),a=this.createLabel(i.toUpperCase());return s.id=`danger-picker-button-${i}`,s.classList.add("danger-picker-button"),n&&s.classList.add("active"),s.append(c),s.append(a),s});t(this,"createIcon",e=>{const i=document.createElement("img");return i.src=e,i.classList.add("danger-picker-button__icon"),i.height=24,i.width=24,i});t(this,"createLabel",e=>{const i=document.createElement("span");return i.classList.add("danger-picker-button__label"),i.innerText=e,i});this.selectedDanger=e,this.emitt=i,this.availableDangers=Object.values(o),this.element=document.createElement("div"),this.buttons=[],this.init()}}const f="/src/assets/icons/";class y{constructor({defaultDanger:e,eventEmitter:i}){t(this,"selectedDanger");t(this,"container");t(this,"button");t(this,"icon");t(this,"emitter");t(this,"init",()=>{this.emitter.subscribe({event:"DANGER_TYPE_CHANGED",callback:e=>{this.update(e)}}),this.container.classList.add("selected-danger"),this.button.append(this.icon),this.button.addEventListener("click",this.handleClick),this.container.append(this.button)});t(this,"createBtn",()=>{const e=document.createElement("button");return e.classList.add("selected-danger-button"),e});t(this,"createIcon",e=>{const i=document.createElement("img");return i.src=e,i.height=128,i.width=128,i});t(this,"handleClick",()=>{this.emitter.notifySubscribers("DANGER_SUBMIT_CLICK",this.selectedDanger)});t(this,"update",e=>{this.selectedDanger=e,this.icon.src=`${f}/${e}.svg`});this.selectedDanger=e,this.emitter=i,this.container=document.createElement("div"),this.button=this.createBtn(),this.icon=this.createIcon(`${f}/${this.selectedDanger}.svg`),this.init()}get element(){return this.container}}const P="/dev-challenge/assets/windrose.c5b00a46.svg";class _{constructor({eventEmitter:e}){t(this,"eventEmitter");t(this,"container");t(this,"image");t(this,"btn");t(this,"canvas");t(this,"ctx");t(this,"init",()=>{this.btn.innerText="Start",this.btn.addEventListener("click",this.getPermissionAndSubscribe),this.image.src=P,this.image.onload=()=>{this.initCanvas()},this.container.append(this.btn),this.container.append(this.canvas)});t(this,"initCanvas",()=>{this.canvas.width=200,this.canvas.height=200,this.canvas.style.border="1px solid red",this.ctx.drawImage(this.image,40,40,120,120),this.ctx.font="24px serif",this.ctx.textAlign="center",this.ctx.fillText("N",120-20,32),this.ctx.fillText("S",120-20,200-18),this.ctx.fillText("W",24,120-12),this.ctx.fillText("E",200-28,120-12)});t(this,"drawRose",e=>{this.ctx.rotate(e),this.ctx.drawImage(this.image,40,40,120,120),this.ctx.font="24px serif",this.ctx.textAlign="center",this.ctx.fillText("N",120-20,32),this.ctx.fillText("S",120-20,200-18),this.ctx.fillText("W",24,120-12),this.ctx.fillText("E",200-28,120-12)});t(this,"getPermissionAndSubscribe",()=>{this.eventEmitter.notifySubscribers("DANGER_SUBMIT_CLICK",""),DeviceMotionEvent&&typeof DeviceMotionEvent.requestPermission=="function"?(DeviceMotionEvent.requestPermission(),window.addEventListener("deviceorientation",this.update)):console.log("Not supported")});t(this,"update",e=>{const{alpha:i,beta:n,gamma:s}=e;if(!i||!n||!s)return;const c=this.compassHeading(i,n,s);console.log(c),this.drawRose(c)});this.eventEmitter=e,this.container=document.createElement("div"),this.image=new Image(100),this.btn=document.createElement("button"),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.init()}get element(){return this.container}compassHeading(e,i,n){const s=Math.PI/180,c=i?i*s:0,a=n?n*s:0,l=e?e*s:0,d=Math.cos(a),u=Math.cos(l),g=Math.sin(c),m=Math.sin(a),p=Math.sin(l),b=-u*m-p*g*d,v=-p*m+u*g*d;let h=Math.atan(b/v);return v<0?h+=Math.PI:b<0&&(h+=2*Math.PI),h}}class C{constructor(){t(this,"subscribers");t(this,"subscribe",e=>{this.subscribers.push(e)});t(this,"notifySubscribers",(e,i)=>{this.subscribers.length&&this.subscribers.forEach(n=>{n.event===e&&n.callback(i)})});t(this,"unsubscribe",e=>{this.subscribers.length&&this.subscribers.filter(({event:i,callback:n})=>i!==e.event&&n!==e.callback)});this.subscribers=[]}}class T{constructor(){t(this,"id");t(this,"geoposition");t(this,"init",()=>{if(!navigator.geolocation||!navigator.geolocation.watchPosition)throw new Error("Geoposition API not supported in your browser.");this.id=navigator.geolocation.watchPosition(e=>{this.geoposition=e.coords,console.log(e)},e=>{console.log(e)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})});t(this,"getPosition",()=>this.geoposition);t(this,"clear",()=>{this.id&&navigator.geolocation.clearWatch(this.id)});this.id=null,this.geoposition=null,this.init()}}class M{constructor(){t(this,"app");t(this,"selectedDanger");t(this,"accelerometer");t(this,"eventEmitter");t(this,"geolocation");t(this,"submitDanger");t(this,"dangerPicker");t(this,"children");this.app=document.createElement("div"),this.selectedDanger=o.helicopter,this.eventEmitter=new C,this.accelerometer=new _({eventEmitter:this.eventEmitter}),this.geolocation=new T,this.submitDanger=new y({defaultDanger:this.selectedDanger,eventEmitter:this.eventEmitter}),this.dangerPicker=new A({defaultDanger:this.selectedDanger,emitt:this.eventEmitter.notifySubscribers}),this.children=[this.accelerometer.element,this.submitDanger.element,this.dangerPicker.element],this.eventEmitter.subscribe({event:"DANGER_TYPE_CHANGED",callback:e=>{this.selectedDanger=e}}),this.eventEmitter.subscribe({event:"DANGER_SUBMIT_CLICK",callback:e=>{console.log(e)}})}render(e){this.children.forEach(i=>{this.app.append(i)}),e.append(this.app)}}const N=document.querySelector("#app"),S=new M;S.render(N);
