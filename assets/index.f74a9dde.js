var E=Object.defineProperty;var x=(c,t,i)=>t in c?E(c,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[t]=i;var e=(c,t,i)=>(x(c,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();var o=(c=>(c.airplane="airplane",c.helicopter="helicopter",c.rocket="rocket",c.drone="drone",c.explosion="explosion",c))(o||{});const D="/dev-challenge/assets/rocket-white.f0779ea1.svg",A="/dev-challenge/assets/drone-white.db8501a6.svg",w="/dev-challenge/assets/airplane-white.58eb1318.svg",k="/dev-challenge/assets/helicopter-white.53fa16e7.svg",I="/dev-challenge/assets/explosion-white.5bbc322b.svg";class L{constructor({defaultDanger:t=o.rocket,emitt:i}){e(this,"buttons");e(this,"emitt");e(this,"availableDangers");e(this,"element");e(this,"selectedDanger");e(this,"handleClick",t=>{const n=t.target.closest("button");if(!n)return;const r=n.id.split("-").at(-1),a=this.availableDangers.find(l=>l===r);a&&a!==this.selectedDanger&&(this.selectedDanger=a,this.emitt("DANGER_TYPE_CHANGED",this.selectedDanger),this.update(this.selectedDanger))});e(this,"init",()=>{this.element.classList.add("danger-picker"),this.buttons=[this.createBtn(D,o.rocket,this.selectedDanger===o.rocket),this.createBtn(A,o.drone,this.selectedDanger===o.drone),this.createBtn(w,o.airplane,this.selectedDanger===o.airplane),this.createBtn(k,o.helicopter,this.selectedDanger===o.helicopter),this.createBtn(I,o.explosion,this.selectedDanger===o.explosion)],this.element.addEventListener("click",this.handleClick),this.buttons.forEach(t=>{this.element.append(t)})});e(this,"update",t=>{const i=this.buttons.find(s=>s.id.includes(t));if(!i)return;const n=this.buttons.find(s=>s.classList.contains("active"));n&&n.classList.remove("active"),i.classList.add("active")});e(this,"createBtn",(t,i,n=!1)=>{const s=document.createElement("button"),r=this.createIcon(t),a=this.createLabel(i.toUpperCase());return s.id=`danger-picker-button-${i}`,s.classList.add("danger-picker-button"),n&&s.classList.add("active"),s.append(r),s.append(a),s});e(this,"createIcon",t=>{const i=document.createElement("img");return i.src=t,i.classList.add("danger-picker-button__icon"),i.height=24,i.width=24,i});e(this,"createLabel",t=>{const i=document.createElement("span");return i.classList.add("danger-picker-button__label"),i.innerText=t,i});this.selectedDanger=t,this.emitt=i,this.availableDangers=Object.values(o),this.element=document.createElement("div"),this.buttons=[],this.init()}}const f="/src/assets/icons/";class y{constructor({defaultDanger:t,eventEmitter:i}){e(this,"selectedDanger");e(this,"container");e(this,"button");e(this,"icon");e(this,"emitter");e(this,"init",()=>{this.emitter.subscribe({event:"DANGER_TYPE_CHANGED",callback:t=>{this.update(t)}}),this.container.classList.add("selected-danger"),this.button.append(this.icon),this.button.addEventListener("click",this.handleClick),this.container.append(this.button)});e(this,"createBtn",()=>{const t=document.createElement("button");return t.classList.add("selected-danger-button"),t});e(this,"createIcon",t=>{const i=document.createElement("img");return i.src=t,i.height=128,i.width=128,i});e(this,"handleClick",()=>{this.emitter.notifySubscribers("DANGER_SUBMIT_CLICK",this.selectedDanger)});e(this,"update",t=>{this.selectedDanger=t,this.icon.src=`${f}/${t}.svg`});this.selectedDanger=t,this.emitter=i,this.container=document.createElement("div"),this.button=this.createBtn(),this.icon=this.createIcon(`${f}/${this.selectedDanger}.svg`),this.init()}get element(){return this.container}}const P="/dev-challenge/assets/windrose.c5b00a46.svg";class _{constructor({eventEmitter:t}){e(this,"eventEmitter");e(this,"container");e(this,"image");e(this,"btn");e(this,"canvas");e(this,"ctx");e(this,"angle");e(this,"fps");e(this,"initAnimation");e(this,"init",()=>{this.canvas.addEventListener("click",this.getPermissionAndSubscribe),this.image.src=P,this.image.onload=()=>{this.initCanvas()},this.container.append(this.btn),this.container.append(this.canvas),this.initAnimation=requestAnimationFrame(this.drawRose)});e(this,"initCanvas",()=>{this.canvas.width=200,this.canvas.height=200,this.canvas.style.border="1px solid red",this.ctx.drawImage(this.image,40,40,120,120),this.ctx.font="24px serif",this.ctx.textAlign="center",this.ctx.fillText("N",120-20,32),this.ctx.fillText("S",120-20,200-18),this.ctx.fillText("W",24,120-12),this.ctx.fillText("E",200-28,120-12)});e(this,"drawRose",()=>{this.ctx.save(),this.ctx.clearRect(0,0,200,200),this.ctx.translate(100,100),this.ctx.rotate(this.angle),this.ctx.translate(-100,-100),this.ctx.drawImage(this.image,40,40,120,120),this.ctx.font="24px serif",this.ctx.textAlign="center",this.ctx.fillText("N",120-20,32),this.ctx.fillText("S",120-20,200-18),this.ctx.fillText("W",24,120-12),this.ctx.fillText("E",200-28,120-12),this.ctx.restore(),this.initAnimation&&(this.angle+=.01),this.initAnimation=requestAnimationFrame(this.drawRose)});e(this,"getPermissionAndSubscribe",()=>{this.eventEmitter.notifySubscribers("DANGER_SUBMIT_CLICK",""),DeviceMotionEvent&&typeof DeviceMotionEvent.requestPermission=="function"?(DeviceMotionEvent.requestPermission(),window.addEventListener("deviceorientation",this.calc),cancelAnimationFrame(this.initAnimation),requestAnimationFrame(this.drawRose)):console.log("Not supported")});e(this,"calc",t=>{if(this.fps+=1,this.fps<=10)return;const{alpha:i,beta:n,gamma:s}=t;!i||!n||!s||(this.angle=this.compassHeading(i,n,s))});this.eventEmitter=t,this.container=document.createElement("div"),this.angle=0,this.fps=0,this.initAnimation=1,this.image=new Image(200),this.btn=document.createElement("button"),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.init()}get element(){return this.container}compassHeading(t,i,n){const s=Math.PI/180,r=i?i*s:0,a=n?n*s:0,l=t?t*s:0,d=Math.cos(a),u=Math.cos(l),g=Math.sin(r),m=Math.sin(a),p=Math.sin(l),b=-u*m-p*g*d,v=-p*m+u*g*d;let h=Math.atan(b/v);return v<0?h+=Math.PI:b<0&&(h+=2*Math.PI),h}}class C{constructor(){e(this,"subscribers");e(this,"subscribe",t=>{this.subscribers.push(t)});e(this,"notifySubscribers",(t,i)=>{this.subscribers.length&&this.subscribers.forEach(n=>{n.event===t&&n.callback(i)})});e(this,"unsubscribe",t=>{this.subscribers.length&&this.subscribers.filter(({event:i,callback:n})=>i!==t.event&&n!==t.callback)});this.subscribers=[]}}class M{constructor(){e(this,"id");e(this,"geoposition");e(this,"init",()=>{if(!navigator.geolocation||!navigator.geolocation.watchPosition)throw new Error("Geoposition API not supported in your browser.");this.id=navigator.geolocation.watchPosition(t=>{this.geoposition=t.coords,console.log(t)},t=>{console.log(t)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})});e(this,"getPosition",()=>this.geoposition);e(this,"clear",()=>{this.id&&navigator.geolocation.clearWatch(this.id)});this.id=null,this.geoposition=null,this.init()}}class T{constructor(){e(this,"app");e(this,"selectedDanger");e(this,"accelerometer");e(this,"eventEmitter");e(this,"geolocation");e(this,"submitDanger");e(this,"dangerPicker");e(this,"children");this.app=document.createElement("div"),this.selectedDanger=o.helicopter,this.eventEmitter=new C,this.accelerometer=new _({eventEmitter:this.eventEmitter}),this.geolocation=new M,this.submitDanger=new y({defaultDanger:this.selectedDanger,eventEmitter:this.eventEmitter}),this.dangerPicker=new L({defaultDanger:this.selectedDanger,emitt:this.eventEmitter.notifySubscribers}),this.children=[this.accelerometer.element,this.submitDanger.element,this.dangerPicker.element],this.eventEmitter.subscribe({event:"DANGER_TYPE_CHANGED",callback:t=>{this.selectedDanger=t}}),this.eventEmitter.subscribe({event:"DANGER_SUBMIT_CLICK",callback:t=>{console.log(t)}})}render(t){this.children.forEach(i=>{this.app.append(i)}),t.append(this.app)}}const N=document.querySelector("#app"),S=new T;S.render(N);
