var E=Object.defineProperty;var D=(c,e,n)=>e in c?E(c,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[e]=n;var t=(c,e,n)=>(D(c,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();var o=(c=>(c.airplane="airplane",c.helicopter="helicopter",c.rocket="rocket",c.drone="drone",c.explosion="explosion",c))(o||{});const x="/dev-challenge/assets/rocket-white.f0779ea1.svg",k="/dev-challenge/assets/drone-white.db8501a6.svg",w="/dev-challenge/assets/airplane-white.58eb1318.svg",I="/dev-challenge/assets/helicopter-white.53fa16e7.svg",L="/dev-challenge/assets/explosion-white.5bbc322b.svg";class A{constructor({defaultDanger:e=o.rocket,emitt:n}){t(this,"buttons");t(this,"emitt");t(this,"availableDangers");t(this,"element");t(this,"selectedDanger");t(this,"handleClick",e=>{const i=e.target.closest("button");if(!i)return;const r=i.id.split("-").at(-1),a=this.availableDangers.find(l=>l===r);a&&a!==this.selectedDanger&&(this.selectedDanger=a,this.emitt("DANGER_TYPE_CHANGED",this.selectedDanger),this.update(this.selectedDanger))});t(this,"init",()=>{this.element.classList.add("danger-picker"),this.buttons=[this.createBtn(x,o.rocket,this.selectedDanger===o.rocket),this.createBtn(k,o.drone,this.selectedDanger===o.drone),this.createBtn(w,o.airplane,this.selectedDanger===o.airplane),this.createBtn(I,o.helicopter,this.selectedDanger===o.helicopter),this.createBtn(L,o.explosion,this.selectedDanger===o.explosion)],this.element.addEventListener("click",this.handleClick),this.buttons.forEach(e=>{this.element.append(e)})});t(this,"update",e=>{const n=this.buttons.find(s=>s.id.includes(e));if(!n)return;const i=this.buttons.find(s=>s.classList.contains("active"));i&&i.classList.remove("active"),n.classList.add("active")});t(this,"createBtn",(e,n,i=!1)=>{const s=document.createElement("button"),r=this.createIcon(e),a=this.createLabel(n.toUpperCase());return s.id=`danger-picker-button-${n}`,s.classList.add("danger-picker-button"),i&&s.classList.add("active"),s.append(r),s.append(a),s});t(this,"createIcon",e=>{const n=document.createElement("img");return n.src=e,n.classList.add("danger-picker-button__icon"),n.height=24,n.width=24,n});t(this,"createLabel",e=>{const n=document.createElement("span");return n.classList.add("danger-picker-button__label"),n.innerText=e,n});this.selectedDanger=e,this.emitt=n,this.availableDangers=Object.values(o),this.element=document.createElement("div"),this.buttons=[],this.init()}}const f="/src/assets/icons/";class P{constructor({defaultDanger:e,eventEmitter:n}){t(this,"selectedDanger");t(this,"container");t(this,"button");t(this,"icon");t(this,"emitter");t(this,"init",()=>{this.emitter.subscribe({event:"DANGER_TYPE_CHANGED",callback:e=>{this.update(e)}}),this.container.classList.add("selected-danger"),this.button.append(this.icon),this.button.addEventListener("click",this.handleClick),this.container.append(this.button)});t(this,"createBtn",()=>{const e=document.createElement("button");return e.classList.add("selected-danger-button"),e});t(this,"createIcon",e=>{const n=document.createElement("img");return n.src=e,n.height=128,n.width=128,n});t(this,"handleClick",()=>{this.emitter.notifySubscribers("DANGER_SUBMIT_CLICK",this.selectedDanger)});t(this,"update",e=>{this.selectedDanger=e,this.icon.src=`${f}/${e}.svg`});this.selectedDanger=e,this.emitter=n,this.container=document.createElement("div"),this.button=this.createBtn(),this.icon=this.createIcon(`${f}/${this.selectedDanger}.svg`),this.init()}get element(){return this.container}}const y="/dev-challenge/assets/windrose.c5b00a46.svg";class _{constructor({eventEmitter:e}){t(this,"eventEmitter");t(this,"container");t(this,"btn");t(this,"canvas");t(this,"ctx");t(this,"init",()=>{this.btn.innerText="Start",this.btn.addEventListener("click",this.getPermissionAndSubscribe),this.initCanvas(),this.container.append(this.btn),this.container.append(this.canvas)});t(this,"initCanvas",()=>{this.canvas.width=200,this.canvas.height=200,this.canvas.style.border="1px solid red";const e=new Image(120,120);e.src=y,e.onload=()=>{this.ctx.drawImage(e,40,40,120,120),this.ctx.font="24px serif",this.ctx.textAlign="center",this.ctx.fillText("N",120-20,32),this.ctx.fillText("S",120-20,200-18),this.ctx.fillText("W",24,120-12),this.ctx.fillText("E",200-28,120-12)}});t(this,"getPermissionAndSubscribe",()=>{this.eventEmitter.notifySubscribers("DANGER_SUBMIT_CLICK",""),DeviceMotionEvent&&typeof DeviceMotionEvent.requestPermission=="function"?(DeviceMotionEvent.requestPermission(),window.addEventListener("deviceorientation",this.update)):console.log("Not supported")});t(this,"update",e=>{const{alpha:n,beta:i,gamma:s}=e;if(!n||!i||!s)return;const r=this.compassHeading(n,i,s);this.ctx.rotate(r)});this.eventEmitter=e,this.container=document.createElement("div"),this.btn=document.createElement("button"),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.init()}get element(){return this.container}compassHeading(e,n,i){const s=Math.PI/180,r=n?n*s:0,a=i?i*s:0,l=e?e*s:0,d=Math.cos(a),u=Math.cos(l),g=Math.sin(r),p=Math.sin(a),m=Math.sin(l),b=-u*p-m*g*d,v=-m*p+u*g*d;let h=Math.atan(b/v);return v<0?h+=Math.PI:b<0&&(h+=2*Math.PI),h*(180/Math.PI)}}class C{constructor(){t(this,"subscribers");t(this,"subscribe",e=>{this.subscribers.push(e)});t(this,"notifySubscribers",(e,n)=>{this.subscribers.length&&this.subscribers.forEach(i=>{i.event===e&&i.callback(n)})});t(this,"unsubscribe",e=>{this.subscribers.length&&this.subscribers.filter(({event:n,callback:i})=>n!==e.event&&i!==e.callback)});this.subscribers=[]}}class M{constructor(){t(this,"id");t(this,"geoposition");t(this,"init",()=>{if(!navigator.geolocation||!navigator.geolocation.watchPosition)throw new Error("Geoposition API not supported in your browser.");this.id=navigator.geolocation.watchPosition(e=>{this.geoposition=e.coords,console.log(e)},e=>{console.log(e)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})});t(this,"getPosition",()=>this.geoposition);t(this,"clear",()=>{this.id&&navigator.geolocation.clearWatch(this.id)});this.id=null,this.geoposition=null,this.init()}}class N{constructor(){t(this,"app");t(this,"selectedDanger");t(this,"accelerometer");t(this,"eventEmitter");t(this,"geolocation");t(this,"submitDanger");t(this,"dangerPicker");t(this,"children");this.app=document.createElement("div"),this.selectedDanger=o.helicopter,this.eventEmitter=new C,this.accelerometer=new _({eventEmitter:this.eventEmitter}),this.geolocation=new M,this.submitDanger=new P({defaultDanger:this.selectedDanger,eventEmitter:this.eventEmitter}),this.dangerPicker=new A({defaultDanger:this.selectedDanger,emitt:this.eventEmitter.notifySubscribers}),this.children=[this.accelerometer.element,this.submitDanger.element,this.dangerPicker.element],this.eventEmitter.subscribe({event:"DANGER_TYPE_CHANGED",callback:e=>{this.selectedDanger=e}}),this.eventEmitter.subscribe({event:"DANGER_SUBMIT_CLICK",callback:e=>{console.log(e)}})}render(e){this.children.forEach(n=>{this.app.append(n)}),e.append(this.app)}}const S=document.querySelector("#app"),B=new N;B.render(S);
